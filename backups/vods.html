<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Yara's VODs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Dark mode preload -->
  <script>
    (function () {
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark-preload");
      }
    })();
  </script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root {
      --primary: #4a6cf7;
      --text-light: #000;
      --text-dark: #cfcfcf;
      --bg-light: #f7f7fb;
      --bg-dark: #1c1c1f;
      --nav-bg-light: #ffffff;
      --nav-bg-dark: #2a2a2d;
      --nav-hover-light: #eef1ff;
      --nav-hover-dark: #3a3a3d;
      --transition-speed: 0.25s;
      --slider-offset-right: 30px;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background var(--transition-speed), color var(--transition-speed);
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    /* prevent flicker */
    .dark-preload body {
      background: var(--bg-dark) !important;
      color: var(--text-dark) !important;
    }

    .dark-preload *,
    .dark-preload *::before,
    .dark-preload *::after {
      transition: none !important;
    }

    nav {
      width: 100%;
      background: var(--nav-bg-light);
      border-bottom: 1px solid #ccc;
      position: fixed;
      top: 0;
      z-index: 20;
      display: flex;
      justify-content: center;
      padding: 14px 24px;
    }

    body.dark nav {
      background: var(--nav-bg-dark);
    }

    .logo {
      position: absolute;
      left: 24px;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary);
    }

    nav ul {
      display: flex;
      gap: 20px;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    nav ul li a {
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 8px;
      color: inherit;
      font-weight: 500;
    }

    nav ul li a.active {
      color: var(--primary);
      font-weight: 700;
    }

    nav ul li a:hover {
      background: var(--nav-hover-light);
      color: var(--primary);
    }

    body.dark nav ul li a:hover {
      background: var(--nav-hover-dark);
    }

    .right-controls {
      position: absolute;
      right: var(--slider-offset-right);
      display: flex;
      gap: 120px;
      align-items: center;
    }

    .switch {
      width: 50px;
      height: 26px;
      position: relative;
    }

    .switch input {
      display: none;
    }

    .slider {
      position: absolute;
      width: 100%;
      height: 100%;
      background: #ccc;
      border-radius: 20px;
      cursor: pointer;
      left: -110px;
    }

    .slider:before {
      content: "";
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: var(--transition-speed);
    }

    input:checked + .slider {
      background: var(--primary);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    main {
      margin-top: 120px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      padding: 20px;
    }

    /* FEATURED */
    .featured {
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 20px;

      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s;
    }

    .featured.fade-in {
      opacity: 1;
    }

    .featured.fade-out {
      opacity: 0;
    }

    .featured-info {
      text-align: center;
      margin-bottom: 25px;
    }

    .scroll-hint {
      text-align: center;
      font-size: 0.95rem;
      opacity: 0.85;
      margin-bottom: 20px;
    }

    /* FILTER BAR */
    .vod-filter-bar {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 25px;
    }

    .vod-filter-bar button {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: var(--nav-bg-light);
      cursor: pointer;
      font-size: 0.85rem;
      transition: 0.25s;
    }

    .vod-filter-bar button.active {
      border-color: var(--primary);
      color: var(--primary);
    }

    /* GRID */
    .vod-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 25px;
    }

    @media (max-width: 1000px) {
      .vod-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 700px) {
      .vod-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 450px) {
      .vod-grid {
        grid-template-columns: 1fr;
      }
    }

    .vod-card {
      background: var(--nav-bg-light);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #ccc;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px);
    }

    body.dark .vod-card {
      background: var(--nav-bg-dark);
    }

    .vod-thumb {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .vod-body {
      padding: 12px 14px;
    }

    @keyframes bounceInSoft {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }

      60% {
        opacity: 1;
        transform: translateY(-6px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .in-view {
      animation: bounceInSoft 0.55s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
    }
.featured iframe {
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}

  </style>
</head>

<body>

  <nav>
    <div class="logo">Yara's Castle</div>
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="../map/index.html">Map</a></li>
      <li><a class="active" href="index.html">VOD's</a></li>
      <li><a href="../other/index.html">Other</a></li>
    </ul>

    <div class="right-controls">
      <span>Night Mode</span>
      <label class="switch">
        <input type="checkbox" id="darkToggle" />
        <span class="slider"></span>
      </label>
    </div>
  </nav>

  <main id="root"></main>

  <script type="text/babel">
    const API_KEY = "AIzaSyCmvdGTCXivYarJUJTfi9Kahg-qdwmv4xI";
    const CHANNEL_HANDLE = "@Yara_ofZelda";

    function formatDate(d) {
      return new Date(d).toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function App() {
      const [videos, setVideos] = React.useState([]);
      const [featuredId, setFeaturedId] = React.useState(null);
      const [fadeState, setFadeState] = React.useState("fade-in");
      const [sortMode, setSortMode] = React.useState("none");

      React.useEffect(() => {
        fetch(
          `https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forHandle=${CHANNEL_HANDLE}&key=${API_KEY}`
        )
          .then(r => r.json())
          .then(data => {
            const playlist = data.items[0].contentDetails.relatedPlaylists.uploads;
            loadAllVideos(playlist);
          });
      }, []);

      async function loadAllVideos(playlistId) {
        let token = "";
        let collected = [];

        while (true) {
          const url =
            `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&maxResults=50&key=${API_KEY}` +
            (token ? `&pageToken=${token}` : "");

          const json = await fetch(url).then(r => r.json());

          const batch = json.items.map(v => ({
            id: v.snippet.resourceId.videoId,
            title: v.snippet.title,
            date: v.snippet.publishedAt
          }));

          collected.push(...batch);

          if (!json.nextPageToken) break;
          token = json.nextPageToken;
        }

        setVideos(collected);
        if (!featuredId) setFeaturedId(collected[0].id);
      }

      const orderedVideos = React.useMemo(() => {
        let arr = [...videos];
        if (sortMode === "newest") {
          arr.sort((a, b) => new Date(b.date) - new Date(a.date));
        } else if (sortMode === "oldest") {
          arr.sort((a, b) => new Date(a.date) - new Date(b.date));
        }
        return arr;
      }, [videos, sortMode]);

      React.useEffect(() => {
        const observer = new IntersectionObserver(
          entries => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add("in-view");
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.2 }
        );

        document
          .querySelectorAll("[data-animate='bounce']")
          .forEach(el => observer.observe(el));

        return () => observer.disconnect();
      }, [orderedVideos.length, featuredId]);

      function pickFeatured(id) {
        if (id === featuredId) return;

        window.scrollTo({ top: 0, behavior: "smooth" });

        setFadeState("fade-out");
        setTimeout(() => {
          setFeaturedId(id);
          setFadeState("fade-in");
        }, 350);
      }

      if (!videos.length || !featuredId) {
        return <div style={{ textAlign: "center", marginTop: 150 }}>Loading VODs…</div>;
      }

      const featured = videos.find(v => v.id === featuredId);

      return (
        <>
          <div
            className={`featured ${fadeState}`}
            data-animate="bounce"
          >
            <iframe
              src={`https://www.youtube.com/embed/${featured.id}`}
              allowFullScreen
            ></iframe>
          </div>

          <div className="featured-info">
            <div style={{ fontSize: "1.4rem", fontWeight: "700" }}>{featured.title}</div>
            <div style={{ opacity: 0.7 }}>{formatDate(featured.date)}</div>
          </div>

          <div className="scroll-hint">Scroll down to see all VODs ⬇️</div>

          <div className="vod-filter-bar">
            <button
              className={sortMode === "newest" ? "active" : ""}
              onClick={() => setSortMode("newest")}
            >
              Newest
            </button>
            <button
              className={sortMode === "oldest" ? "active" : ""}
              onClick={() => setSortMode("oldest")}
            >
              Oldest
            </button>
          </div>

          <div className="vod-grid">
            {orderedVideos.map(v => (
              <div
                className="vod-card"
                key={v.id}
                data-animate="bounce"
                onClick={() => pickFeatured(v.id)}
              >
                <img
                  className="vod-thumb"
                  src={`https://i.ytimg.com/vi/${v.id}/mqdefault.jpg`}
                />
                <div className="vod-body">
                  <div style={{ fontWeight: 600 }}>{v.title}</div>
                  <div style={{ opacity: 0.7 }}>{formatDate(v.date)}</div>
                </div>
              </div>
            ))}
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>

  <!-- Dark mode script -->
  <script>
    const toggle = document.getElementById("darkToggle");

    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      toggle.checked = true;
    }

    toggle.addEventListener("change", () => {
      if (toggle.checked) {
        document.body.classList.add("dark");
        localStorage.setItem("theme", "dark");
      } else {
        document.body.classList.remove("dark");
        localStorage.setItem("theme", "light");
      }
    });

    window.addEventListener("load", () => {
      document.documentElement.classList.remove("dark-preload");
    });
  </script>

</body>
</html>
